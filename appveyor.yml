version: 1.0.{build}
image:
- Visual Studio 2015
test: off
# PING
build:
  parallel: true
platform:
  - x64
environment:
  VSINSTALL: Microsoft Visual Studio 14.0\VC
  CMAKE_GENERATOR: Ninja
  CMAKE_ARCH: x64
  MSVC_PLATFORM: amd64
  PYTHONHOME: C:\Miniconda36-x64
  matrix:
  - CONFIG: Debug
  - CONFIG: Release
init:
  - "set PATH=%PYTHONHOME%;%PYTHONHOME%\\Scripts;%PYTHONHOME%\\Library\\bin;%PATH%"
  - '"C:\Program Files (x86)\%VSINSTALL%\vcvarsall.bat" %MSVC_PLATFORM%'
install:
  - conda config --system --set always_yes yes --set changeps1 no
  - conda config --system --append channels conda-forge
  - conda install -y -n base conda-devenv
  - conda devenv
  - call activate reaktoro
  - set CMAKE_INCLUDE_PATH=%CONDA_PREFIX%\Library\include
  - conda list
build_script:
  - mkdir build
  - mkdir artifacts
  - cd build
  - set MSBuildLogger="C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"
  - cmake -G "%CMAKE_GENERATOR%"
          -DBUILD_ALL=ON
          -DCMAKE_BUILD_TYPE=%CONFIG%
          -DCMAKE_INCLUDE_PATH="%CMAKE_INCLUDE_PATH%"
          -DBOOST_INCLUDE_DIR="%CMAKE_INCLUDE_PATH%"
          -DCMAKE_INSTALL_PREFIX=../artifacts
          -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON
          "-DTHIRDPARTY_COMMON_ARGS=-DCMAKE_VERBOSE_MAKEFILE:BOOL=ON"
          ..
  - cmake --build . --config %CONFIG% --target install
  - dir
  - dir /S ..\artifacts
